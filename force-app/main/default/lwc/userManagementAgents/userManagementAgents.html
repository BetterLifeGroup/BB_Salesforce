<!--
 - Created by frans fourie on 2023/06/22.
 -->

<!-- User Management Agents -->
<template>
    <div style='margin-bottom: 80px'>
        <template if:true={working}>
            <lightning-spinner size='small'></lightning-spinner>
        </template>
        <lightning-input
                label='Include Inactive Agents'
                onchange={handleInactiveSearchChange}
                type='checkbox'
        ></lightning-input>
        <div style='display: flex;flex-direction: row; gap: 12px;align-items: end'>
            <div id="Networks" style='width: 40%'>
                <template if:false={reloadView}>
                    <c-user-management-record-search
                            label=''
                            account-mode={constantTrue}
                            account-scope={accountScope}
                            onrecordselected={contactSelected}
                            onselectioncleared={handleSelectionCleared}
                            additional-info-visible={constantTrue}
                    ></c-user-management-record-search>
                </template>
            </div>
            <div>
                <template if:true={agentSelected}>
                    <template if:true={activeAgent}>
                        <div style='margin-bottom: 9px'>
                            <lightning-button
                                    label='Deactivate'
                                    onclick={handleDeactivate}
                            ></lightning-button>
                        </div>
                    </template>
                    <template if:false={activeAgent}>
                        <div style='margin-bottom: 9px'>
                            <lightning-button
                                    label='Reactivate'
                                    onclick={handleReactivate}
                            ></lightning-button>
                        </div>
                    </template>
                </template>
            </div>
        </div>
        <template if:true={agentSelected}>
            <div>
                <div style='display: flex;flex-direction: row;gap: 6px;align-items: end'>
                    <lightning-input
                            label='First Name'
                            class='inputClass'
                            value={agent.agent.FirstName}
                            onchange={handleAgentFirstNameChange}
                    ></lightning-input>
                    <lightning-input
                            label='Preferred Name'
                            class='inputClass'
                            value={agent.agent.FinServ__PreferredName__c}
                            onchange={handleAgentPreferredNameChange}
                    ></lightning-input>
                    <lightning-input
                            label='Last Name'
                            class='inputClass'
                            value={agent.agent.LastName}
                            onchange={handleAgentLastNameChange}
                            required
                    ></lightning-input>
                    <div style='display: flex;flex-direction: row;' class='searchClass'>
                        <div style='display: flex;flex-direction: column'>
                            <lightning-input
                                    label='4DX Indicator'
                                    type='Checkbox'
                                    checked={agent.agent.X4DX_Indicator__c}
                                    onchange={handle4dxChange}
                            ></lightning-input>
                            <lightning-input
                                    label='P40 Indicator'
                                    type='Checkbox'
                                    checked={agent.agent.P40_Indicator__c}
                                    onchange={handleP40Change}
                            ></lightning-input>
                        </div>
                        <template if:true={showUpdate}>
                            <div style='display: flex;justify-content: start; align-items: end' class='inputClass'>
                                <lightning-button
                                        label='Update'
                                        onclick={handleUpdate}
                                ></lightning-button>
                            </div>
                        </template>
                        <template if:false={showUpdate}>
                            <div style='display: flex;justify-content: start; align-items: end' class='inputClass'>
                                <lightning-button
                                        label='Update'
                                        onclick={handleUpdate}
                                        disabled
                                ></lightning-button>
                            </div>
                        </template>
                    </div>

                </div>
                <div style='display: flex;flex-direction: row;gap: 6px;align-items: end'>
                    <lightning-input
                            label='Email'
                            class='inputClass'
                            value={agent.agent.Email}
                            onchange={handleAgentEmailChange}
                            data-field="email"
                            required
                    ></lightning-input>
                    <lightning-input
                            label='Phone'
                            class='inputClass'
                            value={agent.agent.MobilePhone}
                            onchange={handleAgentMobilePhoneChange}
                            data-field="mobile"
                    ></lightning-input>
                    <!--                    <c-searchable-combobox-->
                    <!--                            class='searchClass'-->
                    <!--                            label='Assigned Branch'-->
                    <!--                            options={branchOptions}-->
                    <!--                            onrecordselected={handleBranchSelected}-->
                    <!--                            selected-value={agent.branch}-->
                    <!--                    ></c-searchable-combobox>-->
                    <div style='width: 25%'>
                        <c-user-management-record-search
                                label='Assigned Branch'
                                onrecordselected={handleBranchSelectedRs}
                                onselectioncleared={handleRemoveBranchRs}
                                selected-value={agent.branch}

                                queried-object-type='Account'
                                query-filter={queryFilter}
                                search-field='Name'
                                agent-mode={constantTrue}
                                contact-mode={constantTrue}
                        ></c-user-management-record-search>
                    </div>
                </div>
                <div style='display: flex;flex-direction: row;gap: 6px;align-items: end'>
                    <div class='inputClass'>
                        <lightning-input
                                label='Commission Entity Id'
                                class='inputClass'
                                value={agent.commId}
                                onchange={handleAgentCommIdChange}
                                data-field="commId"
                                required
                        ></lightning-input>
                    </div>
                    <div class='inputClass'>
                        <lightning-combobox
                                options={vizOptions}
                                label='Visibility'
                                class='inputClass'
                                value={agent.agent.Visibility__c}
                                onchange={handleAgentVizChange}
                                data-field="viz"
                                required
                        ></lightning-combobox>
                    </div>
                </div>
            </div>
            <template if:true={showLinkedConsultants}>
                <div for:each={linkedConsultants} for:item='consultant' key={consultant.Id}>

                    <div style='display: flex;flex-direction: row;gap: 6px; padding-top: 6px;align-items: end'>
                        <c-searchable-combobox
                                class='inputClass'
                                label='Linked Consultant'
                                options={linkedConsultantOptions}
                                onrecordselected={handleLinkedConsultantSelected}
                                selected-value={consultant.FinServ__RelatedContact__r.Name}
                                onrecordremoved={handleRemoveLinkedConsultant}
                                data-id={consultant.Id}
                        ></c-searchable-combobox>
                        <lightning-button-icon
                                icon-name="utility:delete"
                                data-id={consultant.Id}
                                onclick={handleRemoveLinkedConsultant}
                                disabled={consultant.iconDisabled}
                        ></lightning-button-icon>
                        <lightning-button-icon
                                icon-name="utility:add"
                                onclick={handleAddNewLinkedConsultant}
                                disabled={consultant.iconDisabled}
                        ></lightning-button-icon>
                    </div>
                </div>
            </template>
        </template>
    </div>
</template>